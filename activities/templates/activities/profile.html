{% extends "base.html" %}
{% load static %}

{% block title %}Mon Profil - AirLibre{% endblock %}

{% block content %}
<section class="container">
    <div class="profile-container fade-in-up">
        <div class="row">
            <!-- Colonne de gauche : Informations du profil -->
            <div class="col-lg-4">
                <div class="profile-sidebar filters-card">
                    <div class="text-center mb-4">
                        <div class="profile-avatar-container">
                            <div class="profile-avatar-icon" role="img" aria-label="Avatar de {{ user.username }}">
                                <i class="fas fa-user-circle" aria-hidden="true"></i>
                            </div>
                        </div>
                        <h1 class="profile-name mt-3">{{ user.username }}</h1>
                    </div>
                    <div class="profile-info">
                        <div class="info-item">
                            <div class="info-icon">
                                <i class="fas fa-envelope" aria-hidden="true"></i>
                            </div>
                            <div>
                                <strong>Courriel:</strong>
                                {{ user.email|default:"Non renseigné" }}
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-icon">
                                <i class="fas fa-user" aria-hidden="true"></i>
                            </div>
                            <div>
                                <strong>Nom complet:</strong>
                                {% if user.first_name or user.last_name %}
                                {{ user.first_name }} {{ user.last_name }}
                                {% else %}
                                Non renseigné
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="profile-bio mt-4">
                        <h2><i class="fas fa-quote-left me-2 text-success" aria-hidden="true"></i>Biographie</h2>
                        <p class="mt-2">
                            {{ user.bio | default:"Aucune biographie renseignée." }}
                        </p>
                    </div>

                    <!-- Bouton modifier profil -->
                    <div class="mt-4">
                        <div class="d-grid">
                            <a href="{% url 'edit_profile' %}" class="btn btn-details"
                                aria-label="Modifier mon profil utilisateur">
                                <i class="fas fa-edit me-2" aria-hidden="true"></i>
                                Modifier mon profil
                            </a>
                        </div>
                    </div>
                </div>

                <div class="filters-card mt-4">
                    <h2><i class="fas fa-chart-line me-2 text-success" aria-hidden="true"></i>Statistiques</h2>

                    <div class="row text-center mt-3">
                        <div class="col-6">
                            <div class="stat-number" aria-describedby="activities-created-label">
                                {{ activities_proposed.count }}</div>
                            <div class="stat-label" id="activities-created-label">Activités créées</div>
                        </div>
                        <div class="col-6">
                            <div class="stat-number" aria-describedby="inscriptions-label">
                                {{ activities_attending.count }}
                            </div>
                            <div class="stat-label" id="inscriptions-label">Inscriptions</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Colonne de droite : Activités et inscriptions -->
            <div class="col-lg-8">
                <!-- Activités créées -->
                <section class="filters-card" aria-labelledby="my-activities-heading">
                    <!-- Header section responsive -->
                    <div class="row align-items-center mb-4">
                        <div class="col-12 col-sm-8">
                            <h2 id="my-activities-heading" class="mb-0">
                                <i class="fas fa-mountain me-2 text-success" aria-hidden="true"></i>
                                Mes Activités
                            </h2>
                        </div>
                        <div class="col-12 col-sm-4 mt-2 mt-sm-0">
                            <div class="d-grid">
                                <a href="#" class="btn btn-outline-success btn-sm"
                                    aria-label="Créer une nouvelle activité">
                                    <i class="fas fa-plus me-2" aria-hidden="true"></i>
                                    <span class="d-none d-md-inline">Créer une activité</span>
                                    <span class="d-md-none">Créer</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        {% if recent_activities_proposed %}
                        {% for activity in recent_activities_proposed %}
                        <div class="col-md-6 mb-4">
                            <article class="activity-card h-100" aria-labelledby="activity-title-{{ activity.id }}">
                                <div class="card-header">
                                    <h3 id="activity-title-{{ activity.id }}" class="activity-title">
                                        {{ activity.title }}
                                    </h3>
                                    <div class="activity-meta">
                                        <span class="badge badge-primary">{{ activity.category }}</span>
                                        {% now "Y-m-d H:i" as current_time %}
                                        {% if activity.start_time|date:"Y-m-d H:i" > current_time %}
                                        <span class="badge bg-success ms-2">À venir</span>
                                        {% else %}
                                        <span class="badge bg-secondary ms-2">Passé</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="info-item">
                                        <div class="info-icon">
                                            <i class="fas fa-calendar" aria-hidden="true"></i>
                                        </div>
                                        <div>
                                            <strong>Date:</strong>
                                            <time datetime="{{ activity.start_time|date:'Y-m-d\TH:i' }}">
                                                {{ activity.start_time|date:"d M Y à H:i" }}
                                            </time>
                                        </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-icon">
                                            <i class="fas fa-users" aria-hidden="true"></i>
                                        </div>
                                        <div>
                                            <strong>Participants:</strong>
                                            {{ activity.attendees.count }}
                                        </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-icon">
                                            <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                                        </div>
                                        <div>
                                            <strong>Lieu:</strong>
                                            {{ activity.location_city }}
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <div class="row g-2">
                                            <div class="col-12 col-sm-12">
                                                <a href="{% url 'activity_detail' activity.id %}"
                                                    class="btn btn-details btn-sm w-100"
                                                    aria-label="Voir les détails de l'activité {{ activity.title }}">
                                                    <i class="fas fa-eye me-1" aria-hidden="true"></i>
                                                    <span class="d-none d-lg-inline">Voir détails</span>
                                                    <span class="d-lg-none">Détails</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </article>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="col-12">
                            <div class="alert alert-info text-center" role="alert">
                                <i class="fas fa-info-circle fa-2x mb-3" aria-hidden="true"></i>
                                <h3>Aucune activité créée</h3>
                                <p class="mb-0">Vous n'avez pas encore créé d'activités. Commencez par en créer une !
                                </p>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Lien "Voir plus" responsive -->
                    <div class="text-center mt-4">
                        <div class="row justify-content-center">
                            <div class="col-12 col-sm-8 col-md-6">
                                <a href="{% url 'activity_list' %}?category=all&scoop=mine"
                                    class="btn btn-outline-success w-100"
                                    aria-label="Voir la liste complète de toutes mes activités">
                                    <i class="fas fa-list-ul me-2" aria-hidden="true"></i>
                                    <span class="d-none d-sm-inline">Voir toutes mes activités</span>
                                    <span class="d-sm-none">Toutes mes activités</span>
                                    <i class="fas fa-arrow-right ms-2" aria-hidden="true"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Inscriptions -->
                <section class="filters-card mt-4" aria-labelledby="my-registrations-heading">
                    <div class="row align-items-center mb-4">
                        <div class="col-12">
                            <h2 id="my-registrations-heading" class="mb-0">
                                <i class="fas fa-ticket-alt me-2 text-success" aria-hidden="true"></i>
                                Mes Inscriptions
                            </h2>
                        </div>
                    </div>

                    <!-- Activités auxquelles je participe -->
                    <div class="row">
                        {% if recent_activities_attending %}
                        {% for activity in recent_activities_attending %}
                        <div class="col-md-6 mb-4">
                            <article class="activity-card h-100" aria-labelledby="registration-title-{{ activity.id }}">
                                <div class="card-header">
                                    <h3 id="registration-title-{{ activity.id }}" class="activity-title">
                                        {{ activity.title }}
                                    </h3>
                                    <div class="activity-meta">
                                        <span class="badge badge-primary">{{ activity.category }}</span>
                                        {% now "Y-m-d H:i" as current_time %}
                                        {% if activity.start_time|date:"Y-m-d H:i" > current_time %}
                                        <span class="badge bg-success ms-2">À venir</span>
                                        {% else %}
                                        <span class="badge bg-danger ms-2">Passé</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="info-item">
                                        <div class="info-icon">
                                            <i class="fas fa-calendar" aria-hidden="true"></i>
                                        </div>
                                        <div>
                                            <strong>Date:</strong>
                                            <time datetime="{{ activity.start_time|date:'Y-m-d\TH:i' }}">
                                                {{ activity.start_time|date:"d M Y à H:i" }}
                                            </time>
                                        </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-icon">
                                            <i class="fas fa-user" aria-hidden="true"></i>
                                        </div>
                                        <div>
                                            <strong>Organisateur:</strong>
                                            {{ activity.proposer.first_name }}
                                            {{ activity.proposer.last_name|default:activity.proposer.username }}
                                        </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-icon">
                                            <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                                        </div>
                                        <div>
                                            <strong>Lieu:</strong>
                                            {{ activity.location_city }}
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <div class="row g-2">
                                            <div class="col-12 col-sm-12">
                                                <a href="{% url 'activity_detail' activity.id %}"
                                                    class="btn btn-details btn-sm w-100"
                                                    aria-label="Voir les détails de l'activité {{ activity.title }}">
                                                    <i class="fas fa-eye me-1" aria-hidden="true"></i>
                                                    <span class="d-none d-lg-inline">Voir détails</span>
                                                    <span class="d-lg-none">Détails</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </article>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="col-12">
                            <div class="alert alert-info text-center" role="alert">
                                <i class="fas fa-info-circle fa-2x mb-3" aria-hidden="true"></i>
                                <h3>Aucune inscription</h3>
                                <p class="mb-0">Vous n'êtes inscrit à aucune activité. Découvrez les activités
                                    disponibles !</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Lien "Voir plus" responsive pour inscriptions -->
                    <div class="text-center mt-4">
                        <div class="row justify-content-center">
                            <div class="col-12 col-sm-8 col-md-6">
                                <a href="{% url 'activity_list' %}?category=all&scoop=inscrit"
                                    class="btn btn-outline-success w-100"
                                    aria-label="Voir la liste complète de toutes mes inscriptions">
                                    <i class="fas fa-ticket-alt me-2" aria-hidden="true"></i>
                                    <span class="d-none d-sm-inline">Voir toutes mes inscriptions</span>
                                    <span class="d-sm-none">Toutes mes inscriptions</span>
                                    <i class="fas fa-arrow-right ms-2" aria-hidden="true"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</section>
{% endblock %}